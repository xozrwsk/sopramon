CREATE DATABASE sopramon COLLATE utf8_general_ci;

USE sopramon;

CREATE TABLE administrateur (
  ADM_ID INT NOT NULL
) ENGINE = InnoDb;

CREATE TABLE utilisateur (
  UT_ID INT NOT NULL AUTO_INCREMENT,
  UT_NOM VARCHAR(100) NOT NULL,
  UT_PRENOM VARCHAR(100) NOT NULL,
  UT_USERNAME VARCHAR(100) NOT NULL,
  UT_PASSWORD VARCHAR(100) NOT NULL,
  PRIMARY KEY (UT_ID)
) ENGINE = InnoDb;

CREATE TABLE boss (
  BOSS_ID INT NOT NULL AUTO_INCREMENT,
  BOSS_NOM VARCHAR(100) NOT NULL,
  BOSS_NIVEAU INT NOT NULL,
  BOSS_CAPACITE_ID INT NOT NULL,
  BOSS_SIGNE_ID INT NOT NULL,
  BOSS_TYPE_ID INT NOT NULL,
  PRIMARY KEY (BOSS_ID)
) ENGINE = InnoDb;

CREATE TABLE sopramon (
  SOP_ID INT NOT NULL AUTO_INCREMENT,
  SOP_NOM VARCHAR(100) NOT NULL,
  SOP_DATENAIS DATETIME,
  SOP_EXPERIENCE INT DEFAULT 0,
  SOP_NIVEAU INT DEFAULT 1,
  SOP_ARGENT INT DEFAULT 0,
  SOP_CAPACITE_ID INT NOT NULL,
  SOP_UT_ID INT NOT NULL,
  SOP_TYPE_ID INT NOT NULL,
  SOP_SIGNE_ID INT NOT NULL,
  SOP_BANNISSEMENT BOOLEAN,
  PRIMARY KEY (SOP_ID)
) ENGINE = InnoDb;

CREATE TABLE capacite(
  CAP_ID INT NOT NULL AUTO_INCREMENT,
  CAP_POINTVIE INT NOT NULL,
  CAP_ATTAQUE INT NOT NULL,
  CAP_DEFENSE INT NOT NULL,
  CAP_ESQUIVE INT NOT NULL,
  CAP_VITESSE INT NOT NULL,
  CAP_ITEM_ID INT NULL,
  PRIMARY KEY (CAP_ID)
) ENGINE = InnoDb;

CREATE TABLE combat(
  COM_ID INT NOT NULL AUTO_INCREMENT,
  COM_DATE DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  COM_ARENE VARCHAR(100) NOT NULL,
  COM_TYPE INT NOT NULL,
  COM_TOURS INT NOT NULL DEFAULT 0,
  COM_DUEL  BOOLEAN DEFAULT false,
  COM_SOPRAMON_ID INT NOT NULL,
  COM_BOSS_ID INT,
  PRIMARY KEY (COM_ID)
) ENGINE = InnoDb;

CREATE TABLE coup(
  COU_ID INT NOT NULL AUTO_INCREMENT,
  COU_DATE DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  COU_DEGATS INT NOT NULL DEFAULT 0,
  COU_PERSISTENCE INT NOT NULL DEFAULT 0,
  COU_SOPRAMON_ID INT NOT NULL,
  COU_BOSS_ID INT NOT NULL,
  COU_COMBAT_ID INT NOT NULL,
  PRIMARY KEY (COU_ID)
) ENGINE = InnoDb;

CREATE TABLE item(
  ITE_ID INT NOT NULL AUTO_INCREMENT,
  ITE_NOM VARCHAR(100) NOT NULL,
  ITE_PRIX DOUBLE NOT NULL,
  ITE_DESCRIPTION VARCHAR(100) NOT NULL,
  ITE_ATT INT SIGNED NOT NULL DEFAULT 0,
  ITE_DEF INT SIGNED NOT NULL DEFAULT 0,
  ITE_ESQ INT SIGNED NOT NULL DEFAULT 0,
  ITE_VIT INT SIGNED NOT NULL DEFAULT 0,
  PRIMARY KEY (ITE_ID)
) ENGINE = InnoDb;

CREATE TABLE achat(
  ACH_ID INT NOT NULL AUTO_INCREMENT,
  ACH_DATE DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  ACH_PRIX DOUBLE NOT NULL,
  ACH_SOP_ID INT NOT NULL,
  ACH_ITEM_ID INT NOT NULL,
  PRIMARY KEY (ACH_ID)
) ENGINE = InnoDb;

CREATE TABLE type(
  TYP_ID INT NOT NULL AUTO_INCREMENT,
  TYP_NOM VARCHAR(100) NOT NULL,
  PRIMARY KEY (TYP_ID)
) ENGINE = InnoDb;

CREATE TABLE signe(
  SIG_ID INT NOT NULL AUTO_INCREMENT,
  SIG_NOM VARCHAR(100) NOT NULL,
  SIG_TYPE_ID INT NOT NULL,
  PRIMARY KEY (SIG_ID)
) ENGINE = InnoDb;

ALTER TABLE signe
  ADD CONSTRAINT FK_sigType
  FOREIGN KEY (SIG_TYPE_ID)
  REFERENCES type(TYP_ID)
  ON DELETE CASCADE;

ALTER TABLE sopramon
    ADD CONSTRAINT FK_SopSigne
    FOREIGN KEY (SOP_SIGNE_ID)
    REFERENCES signe(SIG_ID)
    ON DELETE CASCADE;


ALTER TABLE sopramon
  ADD CONSTRAINT FK_sopCap
  FOREIGN KEY (SOP_CAPACITE_ID)
  REFERENCES capacite(CAP_ID)
  ON DELETE CASCADE;

ALTER TABLE sopramon
  ADD CONSTRAINT FK_sopUt
  FOREIGN KEY (SOP_UT_ID)
  REFERENCES utilisateur(UT_ID)
  ON DELETE CASCADE;

ALTER TABLE sopramon
    ADD CONSTRAINT FK_sopType
    FOREIGN KEY (SOP_TYPE_ID)
    REFERENCES type(TYP_ID)
    ON DELETE CASCADE;

ALTER TABLE capacite
    ADD CONSTRAINT FK_modifcapacite
    FOREIGN KEY (CAP_ITEM_ID)
    REFERENCES item(ITE_ID)
    ON DELETE CASCADE;

  ALTER TABLE achat
      ADD CONSTRAINT FK_SopramonAchat
      FOREIGN KEY (ACH_SOP_ID)
      REFERENCES sopramon(SOP_ID)
      ON DELETE CASCADE;

  ALTER TABLE achat
    ADD CONSTRAINT FK_itemAchat
    FOREIGN KEY (ACH_ITEM_ID)
    REFERENCES item(ITE_ID)
    ON DELETE CASCADE;

ALTER TABLE combat
    ADD CONSTRAINT FK_combatBoss
    FOREIGN KEY (COM_BOSS_ID)
    REFERENCES boss(BOSS_ID)
    ON DELETE CASCADE;

ALTER TABLE combat
  ADD CONSTRAINT FK_combatSopramon
  FOREIGN KEY (COM_SOPRAMON_ID)
  REFERENCES sopramon(SOP_ID)
  ON DELETE CASCADE;


  ALTER TABLE boss
        ADD CONSTRAINT FK_BossSigne
        FOREIGN KEY (BOSS_SIGNE_ID)
        REFERENCES signe(SIG_ID)
        ON DELETE CASCADE;

ALTER TABLE boss
    ADD CONSTRAINT FK_bossCap
    FOREIGN KEY (BOSS_CAPACITE_ID)
    REFERENCES capacite(CAP_ID)
    ON DELETE CASCADE;

ALTER TABLE boss
        ADD CONSTRAINT FK_bossTYP
        FOREIGN KEY (BOSS_TYPE_ID)
        REFERENCES type(TYP_ID)
        ON DELETE CASCADE;

  ALTER TABLE coup
        ADD CONSTRAINT FK_bossCoup
        FOREIGN KEY (COU_BOSS_ID)
        REFERENCES boss(BOSS_ID)
        ON DELETE CASCADE;

    ALTER TABLE coup
              ADD CONSTRAINT FK_SopramonCoup
              FOREIGN KEY (COU_SOPRAMON_ID)
              REFERENCES sopramon(SOP_ID)
              ON DELETE CASCADE;

  ALTER TABLE coup
            ADD CONSTRAINT FK_CombatCoup
            FOREIGN KEY (COU_COMBAT_ID)
            REFERENCES combat(COM_ID)
            ON DELETE CASCADE;

INSERT INTO capacite
                    (CAP_POINTVIE, CAP_ATTAQUE, CAP_DEFENSE, CAP_ESQUIVE, CAP_VITESSE)
                    VALUES
                      ('500', '50', '50', '50', '50'),
                      ('500', '50', '50', '50', '50'),
                        ('500', '50', '50', '50', '50'),
                        ('500', '50', '50', '50', '50'),
                      ('500', '50', '50', '50', '50'),
                        ('500', '50', '50', '50', '50'),
                        ('500', '50', '50', '50', '50'),
                    ('500', '50', '50', '50', '50'),
                      ('500', '50', '50', '50', '50'),
                      ('500', '50', '50', '50', '50'),
                      ('1000', '100', '100', '100', '100');


INSERT INTO type
          (TYP_NOM)
          VALUES
      ('FEU'),
      ('TERRE'),
      ('AIR'),
      ('EAU');

INSERT INTO signe
            (SIG_NOM,SIG_TYPE_ID)
            VALUES
        ('LION', 1),
        ('BELIER', 1),
        ('SAGITTAIRE', 1),
        ('TAUREAU', 2),
        ('VIERGE', 2),
        ('CAPRICORNE', 2),
        ('GEMEAUX', 3),
        ('BALANCE', 3),
        ('VERSEAU', 3),
        ('POISSONS', 4),
        ('SCORPION', 4),
        ('CANCER', 4);



INSERT INTO utilisateur
	(UT_NOM, UT_PRENOM, UT_USERNAME, UT_PASSWORD)
	VALUES
		('PERROUAULT', 'Jérémy', 'JP', '1'),
		('MORIN', 'Lucile', 'ML', '2'),
    ('LOYER', 'Briac', 'BL', '3'),
		('OZAROWSKI', 'Xavier', 'XO', '4'),
    ('VENIERE', 'Aude', 'AV', '5'),
    ('ASTRUC', 'Arnaud', 'AA', '6'),
    ('DRENO', 'Guillaume', 'GD', '7'),
    ('EBENGE', 'Samuel', 'SE', '8'),
    ('DIKONGUE', 'Emma', 'ED', '9'),
    ('BLANDEL', 'Laila', 'LB', '10');



  INSERT INTO item
            (ITE_NOM, ITE_PRIX, ITE_DESCRIPTION, ITE_ATT, ITE_DEF, ITE_ESQ, ITE_VIT)
            VALUES
        ('Cafe', '5', 'Boire pour avoir des forces', '10', 0, 0, 0),
        ('Coussin', '10', 'DoDO', 0, 0,'10', 0),
        ('Venin', '6', 'kipik', '15', 0,0, 0),
        ('Clés de voiture', '6', 'kiPik', 0, 0,'15', 0),
        ('Chaussures à crampons', '4', 'kiRun', 0, 0,0, '10');

  INSERT INTO boss
            (BOSS_NOM,BOSS_NIVEAU, BOSS_CAPACITE_ID, BOSS_TYPE_ID, BOSS_SIGNE_ID)
            VALUES
        ('BIGBOSS', '10', 11, 4,11);

INSERT INTO sopramon
   	(SOP_NOM,SOP_DATENAIS,SOP_EXPERIENCE,SOP_NIVEAU,SOP_ARGENT,SOP_CAPACITE_ID, SOP_UT_ID, SOP_TYPE_ID, SOP_SIGNE_ID)
    VALUES
   		('JEREMON','1987-11-02','0','1','100',1,1, 4,11),
   		('LULUMON','1992-01-05','0','1','100',2,2, 2, 6),
      ('BRIAMON','1992-02-22','0','1','100',3,3, 4, 10),
      ('XAVIMON','1990-03-14','0','1','100',4,4, 4, 10),
      ('AUDIMON','1992-08-01','0','1','100',5,5, 1, 1),
      ('ARNOMON','1989-06-10','0','1','100',6,6, 3, 7),
      ('GUILLEMON','1994-11-19','0','1','100',7,7, 4, 11),
      ('SAMUMON','1994-07-22','0','1','100',8,8, 4,12),
      ('EMMAMON','1994-12-11','0','1','100',9,9,1,3),
   		('LAILAMON','1992-07-23','0','1','100',10,10,1,1);

UPDATE utilisateur SET UT_BANNISSEMENT = false;

UPDATE utilisateur SET UT_BANNISSEMENT = true
WHERE UT_ID = 4;
